appId: com.habittracker.app
---
# Database Data Integrity E2E Test
# Tests data consistency, constraints, and error handling

- launchApp
- clearState

# Test 1: Verify default task seeding
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    delay: 300

# Check if default tasks are present
- runFlow:
    when:
      visible: 'ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ'
    commands:
      - tapOn: 'ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ'
      - delay: 1000
      # Verify business category tasks
      - assertVisible:
          text: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°'
          optional: true
      - assertVisible:
          text: 'ã‚¹ã‚­ãƒ«å­¦ç¿’'
          optional: true
      # Verify life category tasks
      - assertVisible:
          text: 'é‹å‹•'
          optional: true
      - assertVisible:
          text: 'èª­æ›¸'
          optional: true
      - tapOn:
          text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'
          optional: true

# Test 2: Data consistency across multiple operations
- runFlow:
    when:
      visible: 'ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ'
    commands:
      - tapOn: 'ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ'
      - delay: 1000
      # Select multiple tasks
      - tapOn:
          text: 'é‹å‹•'
          optional: true
      - tapOn:
          text: 'èª­æ›¸'
          optional: true
      - tapOn:
          text: 'ç¢ºå®š'
          optional: true
      - delay: 500

# Complete one task
- runFlow:
    when:
      visible: 'é‹å‹•'
    commands:
      - tapOn:
          id: 'task-checkbox-0'
          optional: true
      - delay: 500

# Add journal entry
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - inputText: 'ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ'
      - delay: 500

# Test 3: Verify statistics consistency
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    delay: 300

# Check if stats reflect the completed task
- assertVisible: 'å®Ÿç¸¾'
- runFlow:
    when:
      visible: '1æ—¥é€£ç¶š'
    commands:
      - assertVisible: '1æ—¥é€£ç¶š'

# Test 4: Calendar heatmap consistency
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    delay: 300

# The current date should show activity
- assertVisible: 'Calendar'

# Test 5: Data persistence under stress
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    delay: 300

# Rapidly toggle task completion
- runFlow:
    when:
      visible: 'é‹å‹•'
    commands:
      - tapOn:
          id: 'task-checkbox-0'
          optional: true
      - delay: 100
      - tapOn:
          id: 'task-checkbox-0'
          optional: true
      - delay: 100
      - tapOn:
          id: 'task-checkbox-0'
          optional: true
      - delay: 100
      - tapOn:
          id: 'task-checkbox-0'
          optional: true
      - delay: 500

# Test 6: Journal entry edge cases
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - clearText
      # Test empty entry
      - delay: 500
      # Test special characters
      - inputText: 'ç‰¹æ®Šæ–‡å­—ãƒ†ã‚¹ãƒˆ: !@#$%^&*()_+-=[]{}|;'':",./<>?'
      - delay: 500
      # Test unicode characters
      - clearText
      - inputText: 'Unicode: ğŸ‰ğŸ“±âœ…â¤ï¸ğŸŒŸğŸ’ªğŸ“šğŸƒâ€â™‚ï¸'
      - delay: 500

# Test 7: Multiple app restarts to test database stability
- stopApp
- delay: 1000
- launchApp
- delay: 2000
- stopApp
- delay: 1000
- launchApp
- delay: 3000

# Verify data survived multiple restarts
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    delay: 300

- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - assertVisible:
          text: 'Unicode'
          optional: true

# Test 8: Date boundary testing
# Navigate to different dates (if date picker is available)
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    delay: 300

# Test 9: Concurrent operation simulation
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    delay: 300

# Simulate rapid UI interactions
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - inputText: 'A'
      - delay: 50
      - inputText: 'B'
      - delay: 50
      - inputText: 'C'
      - delay: 50
      - clearText
      - inputText: 'æœ€çµ‚ãƒ†ã‚¹ãƒˆå®Œäº†'
      - delay: 500

# Test 10: Final integrity check
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    delay: 300
- assertVisible: 'å®Ÿç¸¾'

- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    delay: 300
- assertVisible: 'Calendar'

- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    delay: 300
- assertVisible: 'ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯'

# Clean up
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - clearText
      - delay: 500
