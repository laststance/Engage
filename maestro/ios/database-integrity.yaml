appId: com.anonymous.engage
tags: [ios, database, integrity]
---
# Database Data Integrity E2E Test
# Tests data consistency, constraints, and error handling

- launchApp:
    clearState: true
- waitForAnimationToEnd:
    timeout: 3000

# Test 1: Verify app initialization
- assertVisible:
    id: 'calendar-screen'

# Navigate to Today tab
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test 2: Navigate to Stats to verify initial state
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Wait for stats screen to load
- extendedWaitUntil:
    visible:
      id: 'statistics-screen'
    timeout: 10000

# Test 3: Calendar navigation and data consistency
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Wait for calendar screen to load
- extendedWaitUntil:
    visible:
      id: 'calendar-screen'
    timeout: 10000

# Test 4: Date selection and modal functionality
- tapOn:
    point: 50%, 45% # Middle of calendar
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test journal entry if modal opened
- runFlow:
    when:
      visible:
        id: 'journal-input'
    commands:
      - tapOn:
          id: 'journal-input'
      - inputText: 'データ整合性テスト - 特殊文字: !@#$%^&*()_+-=[]{}|'
      - waitForAnimationToEnd:
          timeout: 1000
      - tapOn:
          id: 'day-modal-close'
      - waitForAnimationToEnd:
          timeout: 2000

# Test 5: Navigation consistency check
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test 6: Stats consistency verification
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test period toggle functionality
- runFlow:
    when:
      visible:
        id: 'stats-month-toggle'
    commands:
      - tapOn:
          id: 'stats-month-toggle'
      - waitForAnimationToEnd:
          timeout: 1000
      - tapOn:
          id: 'stats-week-toggle'
      - waitForAnimationToEnd:
          timeout: 1000

# Test 7: Final verification - return to Calendar
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Final integrity check
- assertVisible:
    id: 'calendar-screen'
