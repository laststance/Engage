appId: com.anonymous.engage
tags: [ios]
---
# Preset Task Management E2E Test
# Tests CRUD operations for preset tasks, category management, and integration with task selection

- launchApp:
    clearState: true

# Wait for app to initialize and load default presets
- waitForAnimationToEnd:
    timeout: 3000

# Navigate to Calendar tab (should be default)
- assertVisible:
    id: 'calendar-screen'

# Open a day by tapping on a date
- tapOn:
    point: 50%, 50% # Tap on middle of calendar (approximate date)
- waitForAnimationToEnd

# Verify Day Sheet is visible
- assertVisible: 'Daily Tasks'

# Test 1: Open Task Picker
- tapOn:
    id: 'task-selection-button'
- waitForAnimationToEnd

# Verify Task Picker is visible with default preset tasks
- assertVisible: 'タスクを選択'
- assertVisible:
    id: 'edit-presets-button'

# Verify default categories and tasks are present
- assertVisible: '事業'
- assertVisible: '生活'

# Scroll to see all tasks
- scroll
- waitForAnimationToEnd

- assertVisible: 'ネットワーキング'
- assertVisible:
    text: '運動.*'

# Test 2: Open Preset Task Editor
- tapOn:
    id: 'edit-presets-button'
- waitForAnimationToEnd

# Verify Preset Task Editor is visible
- assertVisible: 'プリセットタスク編集'
- assertVisible:
    id: 'add-task-button'

# Close preset editor to complete test
- tapOn:
    id: 'preset-editor-cancel'
- waitForAnimationToEnd

# Handle discard alert - try to tap 破棄 button
- tapOn:
    text: '破棄'
    optional: true
- waitForAnimationToEnd:
    timeout: 2000

# Navigate back to calendar using most reliable method
# First try to find and close any open modals
- tapOn:
    text: '破棄'
    optional: true
- waitForAnimationToEnd:
    timeout: 2000

- tapOn:
    id: 'task-picker-close'
    optional: true
- waitForAnimationToEnd:
    timeout: 2000

- tapOn:
    id: 'day-modal-close'
    optional: true
- waitForAnimationToEnd:
    timeout: 3000

# Use more aggressive navigation to ensure we get to calendar
- tapOn:
    point: 17%, 93% # Calendar tab directly
    repeat: 3
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 5000

# Final verification with longer timeout
- extendedWaitUntil:
    visible:
      id: 'calendar-screen'
    timeout: 15000
