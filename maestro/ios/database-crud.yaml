appId: com.habittracker.app
---
# Database CRUD Operations E2E Test
# Tests Create, Read, Update, Delete operations through UI

- launchApp
- clearState

# Setup: Navigate to Today view
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    delay: 300

# Test CREATE operations
- runFlow:
    when:
      visible: 'ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ'
    commands:
      # Test task selection (CREATE completion)
      - tapOn: 'ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ'
      - delay: 1000
      - tapOn:
          text: 'é‹å‹•'
          optional: true
      - tapOn:
          text: 'ç¢ºå®š'
          optional: true
      - delay: 500

# Test journal entry creation
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - inputText: 'åˆå›ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä½œæˆãƒ†ã‚¹ãƒˆ'
      - delay: 500

# Test READ operations - verify data appears
- assertVisible:
    text: 'é‹å‹•'
    optional: true

# Test UPDATE operations
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      # Update journal entry
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - clearText
      - inputText: 'æ›´æ–°ã•ã‚ŒãŸã‚¨ãƒ³ãƒˆãƒªãƒ¼'
      - delay: 500

# Test task completion toggle (UPDATE completion status)
- runFlow:
    when:
      visible: 'é‹å‹•'
    commands:
      - tapOn:
          id: 'task-checkbox'
          optional: true
      - delay: 500
      # Toggle again to test uncomplete
      - tapOn:
          id: 'task-checkbox'
          optional: true
      - delay: 500

# Test data persistence across navigation (READ after navigation)
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    delay: 300
- tapOn:
    point: 50%, 93% # Back to Today tab
    repeat: 2
    delay: 300

# Verify data persisted
- assertVisible:
    text: 'æ›´æ–°ã•ã‚ŒãŸã‚¨ãƒ³ãƒˆãƒªãƒ¼'
    optional: true

# Test DELETE operations
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      # Clear journal entry (DELETE)
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - clearText
      - delay: 500

# Test app restart persistence
- stopApp
- delay: 2000
- launchApp
- delay: 3000

# Navigate back to Today
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    delay: 300

# Verify empty journal entry persisted (DELETE was successful)
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - assertVisible:
          text: 'æ—¥è¨˜ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†'
          optional: true

# Test error handling and data integrity
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      # Test with very long text
      - inputText: 'ã“ã‚Œã¯éå¸¸ã«é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒé©åˆ‡ã«é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡¦ç†ã§ãã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™ã€‚æ—¥æœ¬èªã®æ–‡å­—ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚çµµæ–‡å­—ã‚‚å«ã‚ã¦ã¿ã¾ã—ã‚‡ã† ğŸ‰ ğŸ“± âœ…'
      - delay: 1000

# Navigate away and back to test persistence of long text
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    delay: 300
- tapOn:
    point: 50%, 93% # Back to Today tab
    repeat: 2
    delay: 300

# Verify long text persisted
- runFlow:
    when:
      visible: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
    commands:
      - tapOn: 'ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Š'
      - assertVisible:
          text: 'ã“ã‚Œã¯éå¸¸ã«é•·ã„'
          optional: true

# Clean up for next test
- clearText
- delay: 500
