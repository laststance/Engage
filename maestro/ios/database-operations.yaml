appId: com.anonymous.engage
tags: [ios, database]
---
# Database Operations E2E Test
# Tests data persistence, CRUD operations, and data integrity

- launchApp:
    clearState: true
- waitForAnimationToEnd:
    timeout: 3000

# Test 1: Verify app launches with clean state
- assertVisible:
    id: 'calendar-screen'

# Test 2: Navigate to Today tab and verify initial state
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test 3: Navigate to Stats to verify initial data
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000
- extendedWaitUntil:
    visible:
      id: 'statistics-screen'
    timeout: 10000

# Test 4: Navigate to Calendar to verify heatmap data
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000
- extendedWaitUntil:
    visible:
      id: 'calendar-screen'
    timeout: 10000

# Test 5: Test date selection and modal opening
- tapOn:
    point: 50%, 45% # Middle of calendar
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test 6: If modal opened, test journal entry
- runFlow:
    when:
      visible:
        id: 'journal-input'
    commands:
      - tapOn:
          id: 'journal-input'
      - inputText: 'テストエントリー - データベース操作確認'
      - waitForAnimationToEnd:
          timeout: 1000
      - tapOn:
          id: 'day-modal-close'
      - waitForAnimationToEnd:
          timeout: 2000

# Test 7: Navigate back to Today tab
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test 8: Navigate to Stats and verify data updates
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test 9: Test period toggle functionality
- runFlow:
    when:
      visible:
        id: 'stats-month-toggle'
    commands:
      - tapOn:
          id: 'stats-month-toggle'
      - waitForAnimationToEnd:
          timeout: 1000
      - tapOn:
          id: 'stats-week-toggle'
      - waitForAnimationToEnd:
          timeout: 1000

# Test 10: Final verification - return to Calendar
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000
- assertVisible:
    id: 'calendar-screen'
