appId: com.anonymous.engage
tags: [ios]
---
# Default Preset Task Initialization E2E Test
# Tests that default categories and tasks are properly initialized on first launch
# and that the 3 recommended tasks are suggested to new users

- launchApp
- clearState

# Wait for app initialization and default preset seeding
- waitForAnimationToEnd

# Verify we're on Calendar screen (default) - this will wait for the app to be ready
- assertVisible:
    id: 'calendar-screen'

# Test 1: Verify default categories and tasks are initialized
# Open a day to access task selection
- tapOn:
    point: 50%, 50% # Tap on middle of calendar
- waitForAnimationToEnd

# Open task picker
- tapOn: 'タスクを選択'
- waitForAnimationToEnd

# Verify default categories exist
- assertVisible: '事業'
- assertVisible: '生活'

# Verify default business tasks exist
- assertVisible: 'ネットワーキング'
- assertVisible: 'スキル学習 (30分)'
- assertVisible: 'アイデア記録'

# Verify default life tasks exist
- assertVisible: '運動 (20分以上)'
- assertVisible: '読書・勉強'
- assertVisible: '家族との時間'
- assertVisible: '健康的な食事'
- assertVisible: '十分な睡眠 (7時間)'
- assertVisible: '整理整頓'
- assertVisible: '財務管理'
- assertVisible: '趣味・リラックス'

# Test 2: Verify task durations are properly set
# Open preset editor to check task details
- tapOn: 'プリセットを編集'
- waitForAnimationToEnd

# Verify tasks with durations show the duration
- assertVisible: 'スキル学習 (30分)'
- assertVisible: '運動 (20分以上)'
- assertVisible: '十分な睡眠 (7時間)'

# Test 3: Verify suggested tasks functionality
# Close preset editor
- tapOn: 'キャンセル'
- waitForAnimationToEnd
- tapOn: '破棄'
- waitForAnimationToEnd

# Close task picker
- tapOn:
    id: 'task-picker-close'
- waitForAnimationToEnd

# Close day modal
- tapOn:
    id: 'day-modal-close'
- waitForAnimationToEnd

# Test on a fresh date to see task suggestions
- tapOn:
    point: 70%, 60% # Different date
- waitForAnimationToEnd

- tapOn: 'タスクを選択'
- waitForAnimationToEnd

# The 3 recommended tasks should be prominently available:
# 1. 運動 (20分以上) - Life category, easy to achieve
# 2. ネットワーキング - Business category, important for growth
# 3. 読書・勉強 - Life category, personal development

- assertVisible: '運動 (20分以上)'
- assertVisible: 'ネットワーキング'
- assertVisible: '読書・勉強'

# Test 4: Verify task selection works with default tasks
# Select the 3 recommended tasks
- tapOn: '運動 (20分以上)'
- tapOn: 'ネットワーキング'
- tapOn: '読書・勉強'

# Confirm selection
- tapOn:
    text: '確定 (3個)'
- waitForAnimationToEnd

# Verify tasks appear in Day Sheet
- assertVisible: '運動 (20分以上)'
- assertVisible: 'ネットワーキング'
- assertVisible: '読書・勉強'

# Test 5: Verify category grouping works correctly
# Tasks should be grouped by category with proper counters
- assertVisible: '事業' # Business category header
- assertVisible: '生活' # Life category header

# Progress counters should show (format: completed/total)
# Initially should be 0/1 for business (ネットワーキング)
# and 0/2 for life (運動, 読書・勉強)

# Test 6: Verify task completion updates counters
- tapOn: '運動 (20分以上)'
- waitForAnimationToEnd

# Progress counter for life category should update to 1/2

# Test 7: Verify journal functionality works with default setup
- scroll
- waitForAnimationToEnd

# Find journal section
- assertVisible: '今日の振り返り'

# Test journal input
- tapOn: '日記を書いてみましょう...'
- inputText: 'デフォルトタスクのテストが完了しました'

# Test 8: Verify preset integrity
# Open task picker again
- tapOn: 'タスクを選択'
- waitForAnimationToEnd

# Open preset editor
- tapOn: 'プリセットを編集'
- waitForAnimationToEnd

# Verify all default tasks are properly categorized
# Business tasks should be under 事業 category
- assertVisible: '事業'
- assertVisible: 'ネットワーキング'
- assertVisible: 'スキル学習 (30分)'
- assertVisible: 'アイデア記録'

# Life tasks should be under 生活 category
- assertVisible: '生活'
- assertVisible: '運動 (20分以上)'
- assertVisible: '読書・勉強'

# Test 9: Verify no orphaned tasks or missing categories
# All tasks should have valid categories
# All categories should have at least one task

# Scroll to see all tasks
- scroll
- waitForAnimationToEnd
- swipe:
    direction: UP
- waitForAnimationToEnd

# Test 10: Verify default task titles and durations are correct
# Check specific task configurations
- assertVisible: 'スキル学習 (30分)' # Should have 30 minutes
- assertVisible: '運動 (20分以上)' # Should have 20 minutes
- assertVisible: '十分な睡眠 (7時間)' # Should have 420 minutes (7 hours)

# Test 11: Verify category colors are assigned
# Different categories should have different colored indicators
# (Visual verification - Maestro can't easily test colors)

# Close preset editor without changes
- tapOn: 'キャンセル'
- waitForAnimationToEnd
- tapOn: '破棄'
- waitForAnimationToEnd

# Close task picker
- tapOn:
    id: 'task-picker-close'
- waitForAnimationToEnd

# Close day modal
- tapOn:
    id: 'day-modal-close'
- waitForAnimationToEnd

# Test 12: Verify initialization is idempotent
# Restart app to verify no duplicate initialization
- stopApp
- launchApp
- waitForAnimationToEnd

# Open task picker again
- tapOn:
    point: 50%, 50%
- waitForAnimationToEnd
- tapOn: 'タスクを選択'
- waitForAnimationToEnd

# Should still have the same default tasks, no duplicates
- assertVisible: '事業'
- assertVisible: '生活'
- assertVisible: 'ネットワーキング'
- assertVisible: '運動 (20分以上)'

# Count should still be correct (not doubled)
# Open preset editor to verify
- tapOn: 'プリセットを編集'
- waitForAnimationToEnd

# Should have exactly the expected number of default tasks
# 3 business tasks + 8 life tasks = 11 total
# (Visual count verification would be needed)

# Close everything
- tapOn: 'キャンセル'
- waitForAnimationToEnd
- tapOn: '破棄'
- waitForAnimationToEnd

- tapOn:
    id: 'task-picker-close'
- waitForAnimationToEnd

- tapOn:
    id: 'day-modal-close'
- waitForAnimationToEnd

# Test completed - default preset initialization verified
- assertVisible:
    id: 'calendar-screen'
