appId: com.anonymous.engage
tags: [ios, state-management]
---
# E2E Test for State Management and Business Logic
# This test verifies state persistence and business logic

- launchApp:
    clearState: true
- waitForAnimationToEnd:
    timeout: 3000

# Initialize app and verify initial state
- assertVisible:
    id: 'calendar-screen'

# Navigate to Today tab to start daily flow
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Navigate to Stats tab to verify statistics
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Wait for stats screen to load
- extendedWaitUntil:
    visible:
      id: 'stats-screen'
    timeout: 10000

# Test weekly/monthly toggle
- runFlow:
    when:
      visible:
        id: 'stats-month-toggle'
    commands:
      - tapOn:
          id: 'stats-month-toggle'
      - waitForAnimationToEnd:
          timeout: 1000
      - tapOn:
          id: 'stats-week-toggle'
      - waitForAnimationToEnd:
          timeout: 1000

# Navigate to Calendar tab to verify heatmap
- tapOn:
    point: 17%, 93% # Calendar tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Wait for calendar screen to load
- extendedWaitUntil:
    visible:
      id: 'calendar-screen'
    timeout: 10000

# Test date selection
- tapOn:
    point: 50%, 45% # Middle of calendar
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Test journal entry if modal opened
- runFlow:
    when:
      visible:
        id: 'journal-input-container'
    commands:
      - tapOn:
          id: 'journal-input-container'
      - inputText: '今日はネットワーキングと運動ができて良かった。明日も続けたい。'
      - waitForAnimationToEnd:
          timeout: 1000
      - tapOn:
          id: 'day-modal-close'
      - waitForAnimationToEnd:
          timeout: 2000

# Navigate back to Today tab
- tapOn:
    point: 50%, 93% # Today tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Navigate to Stats tab for final verification
- tapOn:
    point: 83%, 93% # Stats tab
    repeat: 2
    waitToSettleTimeoutMs: 1000
- waitForAnimationToEnd:
    timeout: 2000

# Final verification
- extendedWaitUntil:
    visible:
      id: 'stats-screen'
    timeout: 10000
